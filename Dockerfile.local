# =============================================================================
# Agent Manager - Local Development Dockerfile
# =============================================================================
#
# Agent management UI for Busibox platform.
# This Dockerfile is optimized for local development with hot reload.
#
# Build:
#   docker build -f Dockerfile.local -t agent-manager-local .
#
# Run:
#   docker run -p 3001:3001 -v $(pwd):/app agent-manager-local
#
# =============================================================================

FROM node:20-alpine

# Set working directory
WORKDIR /app

# Install dependencies for node-gyp (native modules)
RUN apk add --no-cache python3 make g++ curl

# Copy package files
COPY package.json package-lock.json ./

# Set up npm authentication for private GitHub packages
ARG GITHUB_AUTH_TOKEN
RUN if [ -n "$GITHUB_AUTH_TOKEN" ]; then \
    echo "//npm.pkg.github.com/:_authToken=${GITHUB_AUTH_TOKEN}" >> ~/.npmrc && \
    echo "@jazzmind:registry=https://npm.pkg.github.com" >> ~/.npmrc; \
    fi

# Install dependencies
RUN npm ci

# Copy the rest of the application
# (This will be overwritten by volume mount in development)
COPY . .

# Expose port
EXPOSE 3001

# Environment
ENV NODE_ENV=development
ENV PORT=3001
ENV HOSTNAME=0.0.0.0

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:3001/ || exit 1

# Start development server
CMD ["npm", "run", "dev", "--", "-p", "3001"]
