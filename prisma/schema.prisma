// Prisma schema for agent-client
// Database: PostgreSQL (pg-lxc)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================================================
// CONVERSATIONS & MESSAGES
// ==========================================================================

model Conversation {
  id         String    @id @default(cuid())
  title      String
  userId     String    @map("user_id")
  messages   Message[]
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")

  @@index([userId])
  @@index([createdAt])
  @@map("conversations")
}

model Message {
  id             String        @id @default(cuid())
  conversationId String        @map("conversation_id")
  conversation   Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  role           MessageRole
  content        String        @db.Text
  attachments    Json?         // Array of attachment objects
  runId          String?       @map("run_id")
  routingDecision Json?        @map("routing_decision") // RoutingDecision object
  toolCalls      Json?         @map("tool_calls") // Array of ToolCall objects
  createdAt      DateTime      @default(now()) @map("created_at")

  @@index([conversationId])
  @@index([createdAt])
  @@map("messages")
}

enum MessageRole {
  user
  assistant
  system
}

// ==========================================================================
// CHAT SETTINGS
// ==========================================================================

model ChatSettings {
  id            String   @id @default(cuid())
  userId        String   @unique @map("user_id")
  enabledTools  String[] @map("enabled_tools")
  enabledAgents String[] @map("enabled_agents")
  model         String?
  temperature   Float    @default(0.7)
  maxTokens     Int      @default(2000) @map("max_tokens")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("chat_settings")
}

// ==========================================================================
// FILE UPLOADS
// ==========================================================================

model FileUpload {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  filename    String
  contentType String   @map("content_type")
  size        Int
  url         String
  minioPath   String?  @map("minio_path")
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@index([createdAt])
  @@map("file_uploads")
}
